{% extends '_layouts/cp' %}

{% do craft.app.getView().registerAssetBundle('modules\\demos\\assets\\guide\\GuideAsset') %}

{% set currentPage = null %}
{% set nextPage = null %}
{% set slug = slug ?? 'welcome' %}

{% set pages = [
  {
    slug: 'welcome',
    title: 'Welcome',
    template: 'welcome.twig'
  },
  {
    slug: 'elements',
    title: 'Content in Craft',
    template: 'elements.twig'
  },
  {
    slug: 'editing',
    title: 'Authoring',
    template: 'editing.twig'
  },
  {
    slug: 'development',
    title: 'Development',
    template: 'development.twig'
  },
  {
    slug: 'further',
    title: 'Going Further',
    template: 'further.twig'
  },
] %}

{% for page in pages %}
  {% if page.slug == slug %}
    {% set currentPage = page %}
    {% set nextPage = pages[loop.index0 + 1] ?? null %}
  {% endif %}
{% endfor %}

{% if currentPage is empty %}
    {% exit 404 %}
{% endif %}

{% set title = systemName ~ ' Guide: ' ~ currentPage.title %}

{% block sidebar %}
  <nav id="guide-subnav">
    <ul>
      {% for page in pages %}
        <li class="{{ page.slug == slug ? 'active' }}">
          {{ tag('a', {
            class: page.slug == slug ? 'sel',
            href: cpUrl('guide/' ~ page.slug),
            text: page.title|t
          }) }}
        </li>
      {% endfor %}
    </ul>
  </nav>
{% endblock %}

{% block content %}
<div id="guide-content">
  {% include 'modules/guide/' ~ currentPage.template %}
</div>

{% if nextPage %}
  {% include 'modules/guide/_next' with {
    label: nextPage.title,
    url: cpUrl('guide/' ~ nextPage.slug)
  } %}
{% endif %}
{% endblock %}
